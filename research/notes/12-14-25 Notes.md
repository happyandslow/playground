



## H2D gemv

### [Horizontal Layout](https://github.com/happyandslow/playground/tree/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants-horizonal)
![Horizontal Layout](https://raw.githubusercontent.com/happyandslow/cs_sdk/main/csl-extras-202505230211-4-d9070058/examples/demo/gemv-h2d-multiple-pes-two-tenants/gemv-h2d-two.png)

**Tile cycles per second**
![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants-horizonal/tile_cycles_per_second_boxplot.png)

**Cycles per second**
![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants-horizonal/cycles_per_second_boxplot.png)

    metric                      count           mean         stddev            min            p25            p50            p75            max
    ------------------------------------------------------------------------------------------------------------------------------------------
    cycle_count                    30         131564        10245.8         119192         122263         130003         136179         150941
    cycles_per_second              30        10577.4        2607.07        7276.47        8421.08        10114.6        11669.9        16002.2
    fabric_x                       30             15              0             15             15             15             15             15
    fabric_y                       30              3              0              3              3              3              3              3
    hwtile_count                   30             17              0             17             17             17             17             17
    idle_ce_cycles                 30        26390.2        9973.18          14215        16373.5        25556.5          30780          44198
    idle_wavelet_cycles            30        26445.2        9973.18          14270        16428.5        25611.5          30835          44253
    init_time                      30      0.0606421      0.0104744       0.018929      0.0566722      0.0585685      0.0696768      0.0756209
    iotile_count                   30              4              0              4              4              4              4              4
    nodes                          30              1              0              1              1              1              1              1
    nultile_count                  30             60              0             60             60             60             60             60
    sim_time                       30        12.9214        2.09259        9.32212        11.5717        12.9451        14.7403        16.6226
    simulated_tile_count           30             21              0             21             21             21             21             21
    sunset_count                   30              0              0              0              0              0              0              0
    threads                        30              5              0              5              5              5              5              5
    tile_count                     30             81              0             81             81             81             81             81
    tile_cycles_per_second         30         222126        54748.6         152806         176843         212407         245069         336045
    tile_cycles_per_second_per_thread     30        44425.3        10949.7        30561.2        35368.5        42481.4        49013.7          67209
    total_time                     30         12.982         2.0936         9.3804         11.627        13.0057        14.7979         16.681

### [Vertical Layout](https://github.com/happyandslow/playground/tree/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants)

![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants/gemv-h2d-two-vertical.png)

**Tile cycles per second**
![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants/tile_cycles_per_second_boxplot.png)

**Cycles per second**
![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants/cycles_per_second_boxplot.png)

    metric                      count           mean         stddev            min            p25            p50            p75            max
    ------------------------------------------------------------------------------------------------------------------------------------------
    cycle_count                    30         123326        8215.78         114523         118107         121482         125218         145008
    cycles_per_second              30        9767.69        2354.51        7216.85        7834.13        9426.12        10959.2        16966.2
    fabric_x                       30             11              0             11             11             11             11             11
    fabric_y                       30              4              0              4              4              4              4              4
    hwtile_count                   30             22              0             22             22             22             22             22
    idle_ce_cycles                 30        21682.5        8088.45          13180          16330          18766        23886.2          41998
    idle_wavelet_cycles            30        21718.5        8088.45          13216          16366          18802        23922.2          42034
    init_time                      30      0.0779923      0.0153216      0.0218961      0.0704498      0.0803239      0.0868466        0.10043
    iotile_count                   30              4              0              4              4              4              4              4
    nodes                          30              1              0              1              1              1              1              1
    nultile_count                  30             48              0             48             48             48             48             48
    sim_time                       30        13.1022        2.13861        8.54688        11.4913        13.1182        14.9188        16.1753
    simulated_tile_count           30             26              0             26             26             26             26             26
    sunset_count                   30              0              0              0              0              0              0              0
    threads                        30              5              0              5              5              5              5              5
    tile_count                     30             74              0             74             74             74             74             74
    tile_cycles_per_second         30         253960        61217.2         187638         203687         245079         284940         441121
    tile_cycles_per_second_per_thread     30          50792        12243.4        37527.6        40737.5        49015.8          56988        88224.2
    total_time                     30        13.1802        2.14069        8.62069        11.5773        13.1927        15.0092        16.2548

### Diagonal Layout

![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants-diagonal/gemv-h2d-two-diag.png)

**Tile cycles per second**
![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants-diagonal/tile_cycles_per_second_boxplot.png)

**Cycles per second**
![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants-diagonal/cycles_per_second_boxplot.png)


    metric                      count           mean         stddev            min            p25            p50            p75            max
    ------------------------------------------------------------------------------------------------------------------------------------------
    cycle_count                    30         119266        6523.12         112697         113801         118004         122793         142894
    cycles_per_second              30        7533.21        1524.02         5862.8        6263.85        7132.29        8393.29        11602.3
    fabric_x                       30             15              0             15             15             15             15             15
    fabric_y                       30              4              0              4              4              4              4              4
    hwtile_count                   30             30              0             30             30             30             30             30
    idle_ce_cycles                 30        17928.3        6077.02          12107          12876          16620        21858.2          39469
    idle_wavelet_cycles            30        17964.3        6077.02          12143          12912          16656        21894.2          39505
    init_time                      30       0.109684      0.0173016       0.046268      0.0984325       0.117383       0.122889       0.131172
    iotile_count                   30              4              0              4              4              4              4              4
    nodes                          30              1              0              1              1              1              1              1
    nultile_count                  30             64              0             64             64             64             64             64
    sim_time                       30        16.2562        2.22814        12.3091        14.7458        16.7129        18.1427        19.2224
    simulated_tile_count           30             34              0             34             34             34             34             34
    sunset_count                   30              0              0              0              0              0              0              0
    threads                        30              5              0              5              5              5              5              5
    tile_count                     30             98              0             98             98             98             98             98
    tile_cycles_per_second         30         256129        51816.5         199335         212971         242498         285372         394477
    tile_cycles_per_second_per_thread     30        51225.8        10363.3          39867        42594.2        48499.6        57074.4        78895.4
    total_time                     30        16.3659        2.22177        12.4293        14.8687        16.8338        18.2404        19.3168

## Decode Block
Parameters

    P: 8
    BSZ: 1
    DIM: 64
    N_HEADS: 1
    N_KV_HEADS: 1
    HEAD_DIM: 64
    SEQ_LEN: 64
    FFN_DIM: 64
    GROUP_NUM: 2
    PE_NUM_PER_GROUP: 4
    ROOT_1ST_PHASE: 2
    ROOT_2ND_PHASE: 6

### Horizontal Layout

    Host: mean cycles count tenant 0: 4970.5
    Host: mean cycles count tenant 1: 4971.5

### Vertical Layout

    Host: mean cycles count tenant 0: 4969.5
    Host: mean cycles count tenant 1: 4970.5

### Diagonal Layout

    Host: mean cycles count t0: 4969.5
    Host: mean cycles count t1: 401.0
    Host: mean cycles count t2: 423.0
    Host: mean cycles count t3: 4971.5



1. Multi-tenant
	1. Wavel project extension
	2. Multi-process management (release/re-acquire resources)
2. Virtual memory/memory hierarchy

<!--stackedit_data:
eyJoaXN0b3J5IjpbLTExODA0ODQxNzgsOTcyMzE5MzI4LC0xMT
UxODY0NjA4LC01NjY4MzQ4MywyMTM0ODUyNDEwLDIwNzcyMTY0
NTAsMTA2MDk4ODAzOSwxNTU1OTQ4Nzg5LC04NjE2ODY4ODUsLT
EyNDQxMjk0NTUsOTkzODk2MTY1LDQ5NzgxODgxMF19
-->