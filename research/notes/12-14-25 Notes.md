



## H2D gemv

### [Horizontal Layout](https://github.com/happyandslow/playground/tree/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants-horizonal)
![Horizontal Layout](https://raw.githubusercontent.com/happyandslow/cs_sdk/main/csl-extras-202505230211-4-d9070058/examples/demo/gemv-h2d-multiple-pes-two-tenants/gemv-h2d-two.png)

Cycles Count
![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants-horizonal/cycle_count_boxplot.png)

**Cycles per second**
![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants-horizonal/cycles_per_second_boxplot.png)

    metric                      count           mean         stddev            min            p25            p50            p75            max
    ------------------------------------------------------------------------------------------------------------------------------------------
    cycle_count                    30         131564        10245.8         119192         122263         130003         136179         150941
    cycles_per_second              30        10577.4        2607.07        7276.47        8421.08        10114.6        11669.9        16002.2
    fabric_x                       30             15              0             15             15             15             15             15
    fabric_y                       30              3              0              3              3              3              3              3
    hwtile_count                   30             17              0             17             17             17             17             17
    idle_ce_cycles                 30        26390.2        9973.18          14215        16373.5        25556.5          30780          44198
    idle_wavelet_cycles            30        26445.2        9973.18          14270        16428.5        25611.5          30835          44253
    init_time                      30      0.0606421      0.0104744       0.018929      0.0566722      0.0585685      0.0696768      0.0756209
    iotile_count                   30              4              0              4              4              4              4              4
    nodes                          30              1              0              1              1              1              1              1
    nultile_count                  30             60              0             60             60             60             60             60
    sim_time                       30        12.9214        2.09259        9.32212        11.5717        12.9451        14.7403        16.6226
    simulated_tile_count           30             21              0             21             21             21             21             21
    sunset_count                   30              0              0              0              0              0              0              0
    threads                        30              5              0              5              5              5              5              5
    tile_count                     30             81              0             81             81             81             81             81
    tile_cycles_per_second         30         222126        54748.6         152806         176843         212407         245069         336045
    tile_cycles_per_second_per_thread     30        44425.3        10949.7        30561.2        35368.5        42481.4        49013.7          67209
    total_time                     30         12.982         2.0936         9.3804         11.627        13.0057        14.7979         16.681

### [Vertical Layout](https://github.com/happyandslow/playground/tree/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants)

![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants/gemv-h2d-two-vertical.png)

Cycles Count
![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants/cycle_count_boxplot.png)

**Cycles per second**
![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants/cycles_per_second_boxplot.png)

    metric                      count           mean         stddev            min            p25            p50            p75            max
    ------------------------------------------------------------------------------------------------------------------------------------------
    cycle_count                    30        45542.1        8822.15          34986        38470.8        43662.5        49005.5          68456
    cycles_per_second              30        14542.2        4362.77        8437.06        11576.7          13493        17392.2        23289.2
    fabric_x                       30             11              0             11             11             11             11             11
    fabric_y                       30              4              0              4              4              4              4              4
    hwtile_count                   30             22              0             22             22             22             22             22
    idle_ce_cycles                 30        23105.8        8471.46          13603        16248.8        22136.5        26521.2          44777
    idle_wavelet_cycles            30        23141.8        8471.46          13639        16284.8        22172.5        26557.2          44813
    init_time                      30      0.0331643     0.00352517       0.022259      0.0306732       0.033325      0.0354793       0.038712
    iotile_count                   30              4              0              4              4              4              4              4
    nodes                          30              1              0              1              1              1              1              1
    nultile_count                  30             48              0             48             48             48             48             48
    sim_time                       30        3.25136       0.489256        2.50481        2.90749        3.19985        3.61596        4.18683
    simulated_tile_count           30             26              0             26             26             26             26             26
    sunset_count                   30              0              0              0              0              0              0              0
    threads                        30              5              0              5              5              5              5              5
    tile_count                     30             74              0             74             74             74             74             74
    tile_cycles_per_second         30         378098         113432         219363         300994         350819         452196         605518
    tile_cycles_per_second_per_thread     30        75619.6        22686.4        43872.7        60198.7        70163.8        90439.3         121104
    total_time                     30        3.28453       0.489043        2.53507        2.93757        3.23631        3.64434        4.22372

### Diagonal Layout

![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants-diagonal/gemv-h2d-two-diag.png)

Cycles Count
![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants-diagonal/cycle_count_boxplot.png)

**Cycles per second**
![enter image description here](https://raw.githubusercontent.com/happyandslow/playground/refs/heads/main/research/wafer/demo/gemv-two-tenants/gemv-h2d-multiple-pes-two-tenants-diagonal/cycles_per_second_boxplot.png)


    metric                      count           mean         stddev            min            p25            p50            p75            max
    ------------------------------------------------------------------------------------------------------------------------------------------
    cycle_count                    30        38210.6        4545.24          32750        34417.2          37189        41694.5          47583
    cycles_per_second              30        9235.78        1963.42        7060.49        7528.58        8612.68        10303.1        14080.9
    fabric_x                       30             15              0             15             15             15             15             15
    fabric_y                       30              4              0              4              4              4              4              4
    hwtile_count                   30             30              0             30             30             30             30             30
    idle_ce_cycles                 30        16500.4        4172.43          11634          12976          15587          19337          24940
    idle_wavelet_cycles            30        16536.4        4172.43          11670          13012          15623          19373          24976
    init_time                      30      0.0444713     0.00490329      0.0275841      0.0414948      0.0444086      0.0484726      0.0507782
    iotile_count                   30              4              0              4              4              4              4              4
    nodes                          30              1              0              1              1              1              1              1
    nultile_count                  30             64              0             64             64             64             64             64
    sim_time                       30        4.21206       0.392787        3.37925        3.85248        4.28658        4.51613        4.79425
    simulated_tile_count           30             34              0             34             34             34             34             34
    sunset_count                   30              0              0              0              0              0              0              0
    threads                        30              5              0              5              5              5              5              5
    tile_count                     30             98              0             98             98             98             98             98
    tile_cycles_per_second         30         314016        66756.4         240057         255972         292831         350305         478752
    tile_cycles_per_second_per_thread     30        62803.3        13351.3        48011.3        51194.4        58566.2          70061        95750.4
    total_time                     30        4.25653       0.391115        3.42704        3.90051        4.33046        4.55671        4.83861


## Decode Block
Parameters

    P: 8
    BSZ: 1
    DIM: 64
    N_HEADS: 1
    N_KV_HEADS: 1
    HEAD_DIM: 64
    SEQ_LEN: 64
    FFN_DIM: 64
    GROUP_NUM: 2
    PE_NUM_PER_GROUP: 4
    ROOT_1ST_PHASE: 2
    ROOT_2ND_PHASE: 6

### Horizontal Layout

    Host: mean cycles count tenant 0: 4970.5
    Host: mean cycles count tenant 1: 4971.5

### Vertical Layout

    Host: mean cycles count tenant 0: 4969.5
    Host: mean cycles count tenant 1: 4970.5

### Diagonal Layout



<!--stackedit_data:
eyJoaXN0b3J5IjpbMTcyNDUwMDY5OSwyMTM0ODUyNDEwLDIwNz
cyMTY0NTAsMTA2MDk4ODAzOSwxNTU1OTQ4Nzg5LC04NjE2ODY4
ODUsLTEyNDQxMjk0NTUsOTkzODk2MTY1LDQ5NzgxODgxMF19
-->